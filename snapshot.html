<html lang="en">

<head>
  <script type="text/javascript" src="repl.js"></script>
</head>

<body>
  <button id="connect">connect</button>
  <button id="run">snapshot</button>
  <button id="camera">camera</button><br>
  <div id='msg'>wait to connect...</div>
  <img id='photo' src='' width='320' height='240'>
  <script type="text/javascript">
  var repl = new REPL()

  connect.addEventListener('click', async () => {
    var code = `
from webai import *
webai.init()
webai.clear()
webai.lcd.init()
webai.img = image.Image()
webai.img.draw_rectangle(0,0,320,240, 0xffeaea, 1,fill=True)
webai.lcd.display(webai.img)
webai.draw_string(60,100,'REPL Ready...',scale=2,x_spacing=3)
webai.img = None
gc.collect()
`;
    connect.disabled = true;
    await repl.usbConnect()
    await repl.enter()
    await repl.write(code);
    connect.disabled = false;
  })

  run.addEventListener('click', async () => {
    run.disabled = true;
    photo.src = await repl.snapshot();
    run.disabled = false;
  })

  camera.addEventListener('click', async () => {
    camera.disabled = true;
    while (true) {
      photo.src = await repl.snapshot();
    };
    camera.disabled = false;
  })
  </script>
</body>

</html>